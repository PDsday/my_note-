>IP包得流动仅仅是在IP层虚拟的数据流动过程，真正的数据传输过程是通过物理地址来进行的。因此，IP包数据会从网络层，传到链路层和硬件层，并通过一些协议，将IP地址映射为MAC地址

---
## ARP缓存表
		每一台计算机内部都会维护一个ARP缓存表，通过命令 arp -a可以看到缓存表的内容
![[Pasted image 20230224094816.png]]

## ARP出现的原因
		数据在以太网环境中传输，实际上用的是MAC地址而不是IP地址，因此，需要将IP映射成MAC地址才行，而ARP协议，则对这种映射的方法做了规定，以保证数据通信的流畅。

#### 映射方式
##### 1、静态映射
		静态映射实际上是将物理地址，和IP地址直接关联起来。当要静态转换某个IP得到物理地址的时候，直接在ARP表中索引，即可得到MAC地址。这样的ARP表，存在于每一个地计算机上。
		例如，目标地址是 224.0.0.22，可以直接在ARP表中，查到物理地址
![[Pasted image 20230224095530.png]]

		然而，这样的映射局限性相当大：
		1、首先是IP的数量非常多，每一个IP都直接对应一个MAC地址，存在表中，让计算机维护不太可能
		2、其次，个人计算机到达新的网络环境，他的IP就会变动，无法做到一个IP指定一个MAC地址的情况
		3、机器更换网络适配器(NIC,网卡)，即使是相同的IP，MAC的地址也会改变
		如果真的一个IP一个地址，那么这个arp表，必须实时更新，不仅麻烦，而且影响性能。

##### 2、动态映射
		动态映射是通过协议报文网络查询进行IP-MAC的映射，只需要维护报文的规则，而不是一张全员ARP表，性能得到大提升。
		这个过程是这样的，首先是：
		1、发送者会将自己的IP,MAC地址，目标IP打包进数据包，发送一个ARP请求报文进入网络。
		2、由于不知到目标的IP，因此是通过广播的形式进入的。
		3、广播使得，局域网中的每一个主机都会收到这个ARP请求报文，然后验证自己的IP和报文目标IP。
		4、验证通过的主机，会以单播的方式，把ARP请求报文中的物理地址（ARP响应），发送给报文请求方。

ARP报文的组成：
![[Pasted image 20230224100845.png]]

在这里有报文详解：
[ARP 协议——将IP地址转换为MAC地址 - 十点书屋 - 博客园 (cnblogs.com)](https://www.cnblogs.com/lanwp1/articles/14418165.html)

---
#### 免费ARP报文
		免费ARP报文的目的不再是请求MAC地址，并且触发方式也不同。
		这种报文，又叫做无故ARP，是一种自问自答的报文。目的是为了检测是否有IP地址冲突。
		它的过程是这样的：
		1、广播的形式发送4条ARP报文
		2、其中前三条报文成为ARP探针
		3、第四条报文成为ARP公告
		探针的目的是，当自身配置IP时，查询周围的主机，有没有IP相同的，如果有，更换IP再次发送免费ARP报文。如果没有，则广播告知天下，这个IP我占领了。
		只有三条ARP报文都没有ARP响应，才认为IP没有冲突。
		而这三条刺探报文的发送者IP都是0，0，0，0,为什么呢？因为此时的主机，配置的IP还没有正式检测可用，因此IP会被配置为0，0，0，0。当三次刺探过后，IP没有冲突，那么SenderIP就变成了自身设置的IP，完成了所谓的自问自答。


---
### 既然IP地址总是要转换成MAC地址的，为什么不直接使用MAC地址？

_**1、硬件制造的厂家不同，因此MAC地址的标准就存在差异
2、互联网实际是各个大大小小的异构网络，每个网络下的硬件地址不同
3、想要让异构网络进行互通，没有IP的话，需要直接对硬件地址做转换
4、标准的差异使得直接转换硬件地址的工作量成为不可能
5、而IP地址是统一分配的，有着唯一的标准**_

