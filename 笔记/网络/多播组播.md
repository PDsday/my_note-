>IP多播

---
### IP多播
		假设有一个视频数据，需要发送到一个子网下的90个主机，如果采用单播的方式，则子网中的路由需要转发90次，对这个路由来讲，是一个重复的工作开销。因此，有人提出了多播的概念。它将目标主机门组成一个多播组，然后由一个专用的多播路由器，统一发送携带组播IP的数据包而不是目标IP。这些组成一个组的主机们，发现了数据包的组IP和自身加入的组IP相同，则复制一份进入自己的主机。

_主机IP一般都是A,B,C类地址，而组IP则是使用D类地址，最大支持互联网中有2的28次方个多播组_
_硬件对D类地址映射成MAC地址时，也会转化为专门的多播MAC_

### 两种多播
- 局域网内的硬件多播
- 互联网内的多播

>多播需要解决的两个问题：
>多播路由怎么知道哪些主机加入了多播，哪些主机又退出了多播？
>多播的成员不在一个子网下，那这个多播需要跳转到其他路由，多播信息携带多播地址，无法通过子网掩码运算，如何选择路由呢？

### 多播协议 IGMP和多播路由选择协议
		IGMP和ICMP类似，它同样是封装在IP数据包中的，向IP提供服务。
		IGMP的工作分为两个部分
		第一阶段：当某个主机加入新的多播组时，该主机会向多播组的多播地址发送一个IGMP报文，声明自己要加入这个多播组。本地的多播路由器收到这个信息后，还需要通过多播路由选择协议，把更新的组员关系转发到其他的多播路由器上。
		第二阶段：组成员的关系是动态的，多播路由器需要周期性的试探组成员是否继续加入多播组。这个多播报文会发送到本地组内的每个主机，如果主机继续加入该组，则回发响应，否则不响应。如果多播路由器的试探报文不再有主机响应，认为这个组已经没有了成员，因此不再将组成员的信息转发到互联网内的其他多播路由器。

		多播路由选择协议尚未标准化。
		例如，一个广播节目，随时都会有听众加入或者离开这个多播组。因此，这个广播的多播数据包发送时，需要转发到源主机所在网络的多播路由器上。可以将所有多播路由器想象成一颗树，目标主机则是叶子，而多播路由器则是根节点。当数据需要转发到这些根节点时，要保证这个根节点多播路由器不会收到重复的多播数据，多播数据也不会在路由之间回环。解决方法采用了以下三种：
		
		（1）、洪泛与剪除(解决回环)
		面对小型的多播组时，所有的组员接入的局域网相邻。当一则国际广播节目发送它的数据到某个美丽国听众的主机上，一开始这个节目的数据会传到多播路由器上，同时洪泛式的转发这个数据包(实际上就是广播给下一层所有的多播路由器)。这些多播路由器每一个都有可能重复洪泛转发回来，为了防止数据有往回发，采用了一种叫做RPB的协议(策略)。
		RPB的要点是，当一个路由收到多播数据包，回线检查数据包是不是从源点最短路径过来的。若是，则直接将数据包泛洪发出，若不是，则丢掉这个数据包。如此，数据包和目标之间就只剩下最短距离的信息能够到达，保证了唯一。这种转发，就像是修剪了其他的路线，或者说枝桠，因此称为剪除。如果一个枝桠下的其他枝桠没有组员，这整个大枝都会被完全剪掉。
		
		（2）、隧道计数
		面对多播组网络之间相邻相当远的情况下，会出现一个支持多播的网络，和另一个支持多播的网络之间，间隔了一个不支持多播的网络。面对这种情况，作为发送者的多播路由器发送广播无法透过中间的网络，因此发送者会将多播数据，按照单播的方式封装，通过中间网络，到达另一个网络的多播路由器，再由作为接受者的多播路由广播。
		上述情况，就好像英吉利海峡隧道不允许汽车在隧道中行驶。但是，可以把汽车放置在隧道中行驶的电气火车上来通过隧道。过了隧道后，汽车又可以继续在公路上行驶。这种使用隧道技术传送数据报又叫做 IP中的 IP (IP-in-IP)。

		（3）、基于核心的发现技术
		这种方式，实际上是在繁杂的多播路由器中，选出一个老大哥。比如一个美丽国下的所有组，选出一个唯一的多播路由老大，华盛顿服务器，当要国际广播发送到美国的某一个订阅用户，则不需要向全球广播，则直接单薄到华盛顿，再由华盛顿广播到这个用户即可。这个选出的老大哥，就是核心路由（CBT）。就像个地区的路由有自己的自治系统(AS)，在这个自治系统下，自发的选择最短路线的多播(MOSPF)