>IP协议是网络层协议，是TCP/IP体系最重要的协议之一，与IP协议配套使用的协议还有ARP，ICMP，IGMP

---
>作为如今互联网的组成标准之一的TCP/IP标准，通过一个IP协议，使得任何一台接入互联网的设备在广袤的互联网中获得了唯一性。
>IP就如同联网设备的身份证，任何一个IP都可以被追踪和定位到。
>那么：IP的原理是什么？
>             IP协议和IP地址之间有什么关系？

### IP协议原理
		数据在传输的时候，会在网络层被分组，打包，被标识上源地址和目标地址。这里的源地址和目标地址，就是ip地址，他保证了数据的最终目的地不会出错，保证快递准确的送到用户的手上。
		这个过程为，假如一个PC想要访问服务器，在他们联网后，PC和服务器就会被分配一个IP,分别是IP1和IP2。PC将自身的请求数据包，封装上自身的地址，在封装上服务器的IP,将他丢进互联网中。在互联网中，有着大量的网络通信设备，通过什么样的路线进入互联网，取决于你接入的网络是那个运行商。通过走运营商的宽带，PC的数据最终会到达路由器，路由器分解IP地址，以接力棒的形式发送到服务器。		
_**很显然,IP协议就是规定了数据的发送者和接收者是谁，IP无法保证数据能不能准确的送到目的地。**_

_IP协议的功能远不止于此。_

#### IP协议头部
>当我们在终端ping一个IP地址的时候，会向这个地址发送数据包，同时地址回发数据包。通过一些软件可以抓取到数据包的信息如下：

![[Pasted image 20230223140012.png]]


在上面的信息中可以看到12个字段，分别是：
- Version（版本号）：
	_V4指IPv4，V6指IPv6。如今的IPv4地址已经枯竭_




- Header Length
_IP头部长度，默认20个字节，最大60个字节_

- Differentiated Services Field
_服务器分区，为不同的IP数据包定义不同的服务质量_
- Total Length
_总长度，IP头部+数据包大小，最大为65535_
- Identification
_标识号，用来区分IP分片来自哪个进程以及IP分片重组_
- Flags
_标识号，用来确认IP是否还能分片或者还有没有分片_
- Fragment offset
_分片偏移量，辅助IP重组_
- Time to live
_生存时间，当时间为0，数据包会被丢弃_
- Protocol
_标识IP的上层应用，TCP=6,UDP=17,ICMP=1_
- Header checksum
_头部校验，检验IP数据包是否完整_
- Source
_发送者IP_
- Destination
_接收者IP_

---

#### Source和Destination
		源地址和目标地址，不做过多的解释

#### Header Length和 Total Length
		对于一个数据包，它被封装了IP头部信息，当数据需要解封装的时候，这个Head Length就能标识到数据包那一部分是IP,那一部分是Data。Toal Length则是数据的总长。

![[Pasted image 20230223141543.png]]

#### Time To Live（TTL）
		生存时间是一个固定的数值，不同的电脑发出数据包的TTL也不同。这个TTL数值，是指数据包，在网络中最多能够传递几个路由。没到达一个路由，TTL就会-1。如果TTL=0,则数据被丢弃。
		之所以如此设计，是因为，网络环境的拓扑结构，使得数据包可能出现回环传递。

![[Pasted image 20230223142101.png]]

		一旦数据包无线回环，这几个路由器将不停的工作，占用线路和带宽，影响其他数据包的接收。因此必须保证数据包在网络里的生存时间，不可以是永久的，避免数据包回环。

_TTL只是网络回环的一个被动解决方案，其根本还是路由解码发生了错误，路线选择有问题，因此，真正要解决回环还是从网络和协议本身改进。_

#### Differentiated Services Field(DSCP)
		即使是网络里的数据包，也不是人人平等的。毕竟互联网是冷战的产物。自然是希望自己总要比别人快才好。DSCP为不同的IP数据包提供不同的服务质量。他就像优先级一样。
		
![[Pasted image 20230223142645.png]]

		PC2的访问就是要比PC1快。因此，运营商相同的套餐也可以配置出不同的网速。

#### Header checksum（头部校验）
		检验数据包是否正确的手段，而IP协议中的头部校验，仅仅检验IP头部信息是否正确而已。而其他部分的检验，则交给其他层的其他协议。这里的校验都是算法的校验，而不是简单的对比相同。


#### Protocol(上层协议号标识)
		网络层上层就是传输层。为什么要在这里标识传输层用的什么协议呢？
		很好理解。当PC1的数据报采用TCP传输，IP层就会标识它是TCP封装的，当PC2得到这个数据，PC2的网络层解包之后，会告知上层这是TCP封装，他就会按照TCP解封的方式。此外，其他协议中的端口号，类型值等等都是相同的作用。

---
## IP地址是唯一的，它是如何分配的?
>遵守IP协议的上网设备一定会在接入互联网时，被分配一个IP地址

##### IP地址的表示方法
		任何一个IP地址都由两部分共32个字节组成，分别是网络号和主机号；
		1、A类IP，网络号为8位，主机号为24位
		2、B类IP，网络号为16位，主机号为16位
		3、C类IP，网络号为24位，主机号位8位
		4、D类IP，网络号为1110，主机号均为多播地址
		5、E类IP，网络号为1111，为今后更多的设备接入互联网预留
		A类IP都是一些大厂的专属IP，例如苹果，三星等大公司使用，小老百姓则是C类IP。IP的分配都是IANA组织分配的，不同地区分配的IP也有差异。
		另外，从网络层来看，数据的传输就是一个IP到另一个IP，但实际上，IP并不是互联网里的主要敲门砖，而是数据链路层和硬件层的物理地址，也就是Mac地址，IP地址没到达一个中间节点都会被映射成物理地址，毕竟硬件是看不懂软件IP的，且要真让IP作为物理地址标识，这32位数完全不够看，毕竟如今的IPv4地址，都已经枯竭。
		将IP和物理地址互相映射的协议是ARP协议和RARP协议，都是后话。


##### 子网
		地址的查找实际上以一个子网一个子网的跳转：
		比如一起数据报的地址是 143.13.3.10
		那么，他会先找到子网，地址通过子网掩码与运算，得到子网地址。
-   A类地址的默认子网掩码是255.0.0.0
-   B类地址的默认子网掩码是255.255.0.0
-   C类地址的默认子网掩码是255.255.255.0

		则143.13.3.10的子网就是与C类地址掩码进行与运算，是143.13.3.0
		再通过最后一位10，确认目标是该子网中的第10台主机。



---

# MAC地址
>1、mac地址又叫做局域网地址，以太网地址，或物理地址。
>2、mac地址也是一个联网设备的唯一标识。
>3、每一个网卡都需要并且会有一个mac地址。
>4、一台设备如果有多个网卡，则每个网卡都会有一个唯一的mac地址。

		IP地址是可以修改的，它就像是计算机再互联网中的网名，只要再一个子网中，并且没有人与你修改的IP同名，就算你从192.168.1.10，改成192.168.1.33，只要没有另一台33，你的IP就是可用IP，你也一样可以再互联网中畅游。但是，修改了IP，为什么另一方通信依旧可以稳健的发送的我们的设备。以手机来说，不管是接wifi还是用流量，IP都会发生变化，但为什么数据包依旧能够准确无误的找到我们的设备。原因就在于，每一个连接进网络的物理设备(网卡)，它都有一个真正唯一的物理标号，mac地址。
		如今上网的大多数人的方法，就是将自己的计算机和接入局域网，再通过交换机或者路由器等设备，实现和Internet的连接。由于IP地址只是逻辑上的标识，可以修改就意味着可以被盗用。然而mac地址不然，它是被固化再硬件中的参数，除非小偷跑来偷走你的网卡，否则他也无法通过IP地址去冒充你。
		无论是[局域网]还是[广域网]中的计算机之间进行通信时，最终都表现为将数据包从某种形式的链路上的一个初始节点出发，从一个节点传递到另一个节点，最终传送到目的节点。数据包在这些节点之间的传递都是由 ARP[地址解析协议]负责将[IP地址]映射到 MAC地址上来完成的。
