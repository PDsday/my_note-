>设备驱动就是趋势硬件设备进行工作。驱动直接和底层交接，趋势硬件动作，从而获取硬件设备的数据传递给上层应用软件，驱动设备充当了硬件和软件之间的纽带，应用软件只需要调用相应得API就可以控制硬件完成工作要求。

_**驱动得作用可以简述为：向上提供接口，向下访问硬件**_

![[Pasted image 20230313154611.png]]

---
### 驱动分类
		驱动就是一个让硬件工作起来得代码，本身属于软件一类。在STM32编程，操作外围器件，LED时，可以理解他们为裸机驱动。但严格一点说，如果没有操作系统，驱动得概念得不成立的。
		因此，从狭义上说，驱动应该是操作系统用来控制硬件的逻辑方法。
		Linux驱动分类三个基础大类：

##### 1、字符设备驱动
		字符设备提供的是一种数据流。鼠标、键盘、显示器等都是典型的字符设备。每一个字符设备在/dev目录下都有一个设备文件，linux用户程序通过设备文件(又称为设备节点)来使用驱动程序操作字符设备和块设备。
可以看见C语言编程时候的老朋友，stdin，stdout，stderr
![[Pasted image 20230313160542.png]]

##### 2、块设备驱动
		块设备的驱动可能要求读取块设备上任意块的内容，然后有转去其他块读取。读取的位置不像流水一样连续，而是可以随机访问。如果满足这种任意读取的条件，那它就是一个块设备。
##### 3、网络设备驱动
		网络设备驱动是特殊的设备驱动，它负责接收和发送数据帧，可能是物理帧，也可能是IP数据包，这些特性由网络驱动决定。
		常见的网络设备有：蓝牙、wifi、网卡等。

---
		三种设备中，字符设备最多，也最简单，块设备和网络设备驱动要比字符设备驱动复杂得多。网络设备驱动不管是有线得还是无线得，都属于网络设备驱动得范畴。
		一个设备可以属于多种设备驱动类型，例如USB WIFI，它既是字符设备驱动又是网络设备驱动。

---
# 系统运行的四大组件
>uboot、kernel、设备树dtb、根文件系统


### 1、设备树

		底层硬件和内核之间的交互以来厂家的板级支持包。而内核之中，充斥着大量的描述不同板级硬件信息的代码，而对于这些板级信息，对于内核而言实际上属于垃圾代码。因为不同厂家的板级支持包各有差异，一般一个产品只会用到一个板级硬件信息，其他存放的信息就显得很多余。
		设备树是用来解决这部分问题的，它实际上也是软件代码。它的作用就是内核不在存储硬件信息，板级支持包BSP中的 bootloader会通过设备树，这就是这个软件，把信息传给内核。设备树，则负责把地秤上来的硬件信息整理成册，提供内核访问。
		设备树的硬件描述是实时的，他会显示CPU的数量，类别，内存基址的大小，总线和桥，外设连接，中断控制器和中断使用情况。面对热插拔的设备，设备树不会去描述它。
		有了设备树，当更换同一个SOC的不同主板，内核可以不用变动，直接更换设备树文件就好。

##### DTC(device tree compiler)、DTS(device tree source)、DTB(device tree blob)
>DTS/DTSI 为设备树的源文件，他们经过DTC(设备树的专用编译器)会被编译成dtb二进制文件，这个dtb二进制文件，就是最终要烧录到板子里的。

----

### 2、pinctrl


----
#### 3、设备号
		内核为了方便管理硬件，给每个硬件设置了设备号。设备号由主设备号和此设备号组成，主设备号标识一个具体的驱动，次设备号便是使用这个驱动的各个设备。

>linux的设备号相关文件在 include/linux/types.h里。
>在编写代码时，直接 include <linux/types.h>即可。


![[Pasted image 20230317142032.png]]



![[Pasted image 20230317142051.png]]

>不过，linux下有两个types.h，另一个是sys/types.h。不要用错。

---
#### 4、模块
		linux的驱动运行方法有两种，一种是将驱动编译进入内核，当linux内核启动的时候就会手动运行驱动程序。第二种是将举动编撰成模块。
		模块是可随意拆卸添加的，因此作驱动调试的时候，将驱动编译成模块是常见的方式。

>linux模块相关的头文件在内核头文件下，默认的编译环境是找不到它的。
>在编译时，同样引入 include <linux/module.h>

![[Pasted image 20230317142637.png]]


----
### 5、节点
		硬件驱动加载后，并不会自己挂载在/dev下，还需要程序员手动的创建设备节点文件。创建的节点文件需要对应设备的主次设备号。

