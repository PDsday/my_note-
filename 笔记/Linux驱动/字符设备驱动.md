>和上文的框架是相似的，字符设备驱动唯一多出来的东西就是，需要申请设备号，以及复现读写操作。


---

		写驱动首先要知道驱动是怎么工作的。复现驱动的工作过程，更好理解写驱动到底要写哪些部分。

>除了网络设备，字符设备和块设备如果有相应的驱动，就会在/dev下对应一个设备文件。linux用户通过操作文件的方式，实现这些硬件设备的操控。


![[Pasted image 20230317144211.png]]
>可以看见，即使是虚拟机虚拟甚至是借用了主机的许多硬件，例如 fb0是屏幕，tty0硬件串口，以及stm32时的老朋友 rtc 实时时钟。

		用户调用open，read,write等文件io API，调用这些设备文件，这个过程称为用户调用。用户调用会唤醒内部的系统调用API。
		这些系统调用API仅有定义而没有实现。
		它们被集中在一个 file_operations的结构体中。
		想必你已经知道了，字符驱动的编写，就是晚上这个file_operations结构体而已。

![[Pasted image 20230317144958.png]]


### 最简单的字符设备驱动流程

##### 1、搭建框架
>首先，搭建一个驱动模块编译的框架。
>创建一个目录，命名为 Bdevice_driver_test，并在之下，创建框架代码文件， hello.c
![[Pasted image 20230317150046.png]]
>我们的驱动将要在本虚拟机中运行，因此需要用到这个虚拟机安装的内核的支持。通过命令 uname -a查看内核的信息
![[Pasted image 20230317150222.png]]
>所用内核为 4.15.0-142，因此我们也需要找到对应名称的内核头文件所在
>文件一般存放在 usr/src/下

![[Pasted image 20230317150459.png]]
>将 对应的头文件包路径，仿佛vscode配置文件，在写代码的时候可以得到字符串联想支持。

![[Pasted image 20230317155311.png]]
>如果配置依旧有红色大波浪，多包含几个路径文件。如果无法消除，也并不会影响最后的编译。vscode只是一个辅助写代码的文本编辑器罢了。








